<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>DarkCPU: $title</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">DarkCPU
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('interrupt10c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#interrupt">Interrupt Handler</a><ul><li class="level2"><a href="#interruptDetails">Module Details</a></li>
<li class="level2"><a href="#interrupts">Interrupts</a></li>
<li class="level2"><a href="#softwareInterrupts">Software Interrupts</a></li>
</ul>
</li>
<li class="level1"><a href="#DASMDOC_S47">Constants</a><ul><li class="level2"><a href="#DASMDOC_S48">INTERRUPT_MESSAGE_DEBUGBREAK</a></li>
<li class="level2"><a href="#DASMDOC_S49">INTERRUPT_MESSAGE_KERNELERROR</a></li>
<li class="level2"><a href="#DASMDOC_S50">INTERRUPT_MESSAGE_THREADENDCYCLE</a></li>
<li class="level2"><a href="#DASMDOC_S51">INTERRUPT_MESSAGE_THREADEXCEPTION</a></li>
<li class="level2"><a href="#DASMDOC_S52">INTERRUPT_DEVICEMASK</a></li>
</ul>
</li>
<li class="level1"><a href="#DASMDOC_S53">Functions</a><ul><li class="level2"><a href="#DASMDOC_S54">interrupt_enable</a></li>
<li class="level2"><a href="#DASMDOC_S55">interrupt_disable</a></li>
<li class="level2"><a href="#DASMDOC_S56">interrupt_handler</a></li>
<li class="level2"><a href="#DASMDOC_S57">interrupt_handler_breakpoint</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h2>interrupt10c</h2>
<h1><a class="anchor" id="interrupt"></a>
Interrupt Handler</h1>
<h2><a class="anchor" id="interruptDetails"></a>
Module Details</h2>
<p>This module contains the kernel's primary interrupt handler and branches interrupts off to their appropriate handlers </p>
<dl class="section author"><dt>Author</dt><dd>Jeremy (0x10cforums.com) </dd></dl>
<dl class="section version"><dt>Version</dt><dd>1.0 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>Dec, 18, 2012</dd></dl>
<h2><a class="anchor" id="interrupts"></a>
Interrupts</h2>
<p>Whenever a critical event occurs in the system or when a peripheral device wishes to communicate with the DCPU, an interrupt with a given message code is raised. The currently executing thread is halted and control is passed immediately over to the kernel's interrupt manager to deal with the interrupt.</p>
<p>There are two catagories of interrupts, both of which require interrupts be enabled for use:</p>
<ul>
<li>Software Interrupts<ul>
<li>Interrupts are raised on a software level. I.e, are raised when the INT instruction is invoked. This is typically used when the software must make the kernel aware of something. Message codes for software interrupts always have their highest 8 bits cleared.</li>
</ul>
</li>
</ul>
<p><a class="anchor" id="hardwareInterrupts"></a></p>
<ul>
<li>Hardware Interrupts<ul>
<li>Interrupts raised by peripheral hardware. These sorts of interrupts are raised when a device has the intention of communicating with the kernel. I.e, to notify the kernel that the requested sectors have been read from the HMD into memory. All hardware interrupts will have their interrupt codes masked with INTERRUPT_DEVICEMASK, I.e, the highest 8 bits of the interrupt message are always set for a hardware interrupt.</li>
<li>All hardware interrupts are routed from here to the DeviceManager module</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="softwareInterrupts"></a>
Software Interrupts</h2>
<table class="doxtable">
<tr>
<th>Interrupt Code </th><th>Description</th></tr>
<tr>
<td>INTERRUPT_MESSAGE_DEBUGBREAK </td><td>Executes an ISR which returns to the caller immediately. If DarkCPU is running inside of a debugger, a debug breakpoint can be placed on this routine to break the debugger whenever it is called. This allows one to strategically place invokes to this interrupt in areas of code where the debugger in use may not support breakpoints. Useful for debugging user applications loaded into memory at runtime. </td></tr>
<tr>
<td>INTERRUPT_MESSAGE_KERNELERROR </td><td>Halts the kernel when it detects an error. Disabling interrupts to prevent damage done to the DCPU </td></tr>
<tr>
<td>INTERRUPT_MESSAGE_THREADENDCYCLE </td><td>An interrupt raised by a thread when it has completed its task or wishes to pass control over to the next thread in queue. </td></tr>
<tr>
<td>INTERRUPT_MESSAGE_THREADEXCEPTION </td><td>Not yet implemented. Raised when a thread encounters an exception. The kernel will walk through the thread's SEH chain to find an appropriate exception handler. </td></tr>
</table>
<h1><a class="anchor" id="DASMDOC_S47"></a>
Constants</h1>
<hr/>
 <h2><a class="anchor" id="DASMDOC_S48"></a>
INTERRUPT_MESSAGE_DEBUGBREAK</h2>
<p><code>WORD</code> INTERRUPT_MESSAGE_DEBUGBREAK <br/>
<br/>
<b>Description:</b><br/>
 Defines the interrupt code for a DEBUGBREAK. Refer to <a class="el" href="interrupt10c.html#softwareInterrupts">Software Interrupts</a> <br/>
<br/>
</p>
<p><b>Code:</b> </p>
<div class="fragment"><div class="line"><span class="preprocessor">#define INTERRUPT_MESSAGE_DEBUGBREAK      3</span></div>
</div><!-- fragment --><hr/>
 <h2><a class="anchor" id="DASMDOC_S49"></a>
INTERRUPT_MESSAGE_KERNELERROR</h2>
<p><code>WORD</code> INTERRUPT_MESSAGE_KERNELERROR <br/>
<br/>
<b>Description:</b><br/>
 Defines the interrupt code for a KERNELERROR. Refer to <a class="el" href="interrupt10c.html#softwareInterrupts">Software Interrupts</a> <br/>
<br/>
</p>
<p><b>Code:</b> </p>
<div class="fragment"><div class="line"><span class="preprocessor">#define INTERRUPT_MESSAGE_KERNELERROR         4</span></div>
</div><!-- fragment --><hr/>
 <h2><a class="anchor" id="DASMDOC_S50"></a>
INTERRUPT_MESSAGE_THREADENDCYCLE</h2>
<p><code>WORD</code> INTERRUPT_MESSAGE_THREADENDCYCLE <br/>
<br/>
<b>Description:</b><br/>
 Defines the interrupt code for a THREADENDCYCLE. Refer to <a class="el" href="interrupt10c.html#softwareInterrupts">Software Interrupts</a> <br/>
<br/>
</p>
<p><b>Code:</b> </p>
<div class="fragment"><div class="line"><span class="preprocessor">#define INTERRUPT_MESSAGE_THREADENDCYCLE  5</span></div>
</div><!-- fragment --><hr/>
 <h2><a class="anchor" id="DASMDOC_S51"></a>
INTERRUPT_MESSAGE_THREADEXCEPTION</h2>
<p><code>WORD</code> INTERRUPT_MESSAGE_THREADEXCEPTION <br/>
<br/>
<b>Description:</b><br/>
 Defines the interrupt code for a THREADEXCEPTION. Refer to <a class="el" href="interrupt10c.html#softwareInterrupts">Software Interrupts</a> <br/>
<br/>
</p>
<p><b>Code:</b> </p>
<div class="fragment"><div class="line"><span class="preprocessor">#define INTERRUPT_MESSAGE_THREADEXCEPTION 6</span></div>
</div><!-- fragment --><hr/>
 <h2><a class="anchor" id="DASMDOC_S52"></a>
INTERRUPT_DEVICEMASK</h2>
<p><code>WORD</code> INTERRUPT_DEVICEMASK <br/>
<br/>
<b>Description:</b><br/>
 Defines the mask which must be applied to the all device interrupt message codes. Refer to <a class="el" href="interrupt10c.html#hardwareInterrupts">hardwareInterrupts</a> <br/>
<br/>
</p>
<p><b>Code:</b> </p>
<div class="fragment"><div class="line"><span class="preprocessor">#define INTERRUPT_DEVICEMASK          0xFF00</span></div>
</div><!-- fragment --><h1><a class="anchor" id="DASMDOC_S53"></a>
Functions</h1>
<hr/>
 <h2><a class="anchor" id="DASMDOC_S54"></a>
interrupt_enable</h2>
<p><a class="el" href="calling_conventions.html#cdecl">cdecl</a> VOID interrupt_enable() <br/>
<br/>
<b>Description:</b><br/>
 Enables interrupts to be processed by the system. Once called, the interrupt manager will be active and devices can communicate to the kernel via interrupts <br/>
</p>
<dl class="section return"><dt>Returns</dt><dd><code>VOID</code> <br/>
</dd></dl>
<p><b>Code:</b> </p>
<div class="fragment"><div class="line">ias interrupt_handler   ; Set interrupt handler.</div>
<div class="line">iaq 0                   ; Disable interrupt queue</div>
<div class="line">ret                     ; <span class="keywordflow">return</span> to caller </div>
</div><!-- fragment --><hr/>
 <h2><a class="anchor" id="DASMDOC_S55"></a>
interrupt_disable</h2>
<p><a class="el" href="calling_conventions.html#cdecl">cdecl</a> VOID interrupt_disable() <br/>
<br/>
<b>Description:</b><br/>
 Disabled interrupts from being processed by the system. <br/>
</p>
<dl class="section return"><dt>Returns</dt><dd><code>VOID</code> <br/>
</dd></dl>
<p><b>Code:</b> </p>
<div class="fragment"><div class="line">iaq 1                       ; Enable interrupt queue</div>
<div class="line">ias 0                       ; Disable interrupts</div>
<div class="line">ret                         ; Return to caller  </div>
</div><!-- fragment --><hr/>
 <h2><a class="anchor" id="DASMDOC_S56"></a>
interrupt_handler</h2>
<p><a class="el" href="calling_conventions.html#isrcall">isrcall</a> VOID interrupt_handler() <br/>
<br/>
<b>Description:</b><br/>
 The primary interrupt handler of the DarkCPU kernel. This routine is responsible for locating the appropriate handlers for the thrown interrupt. If no appropriate handler is found, the interrupt is ignored. <br/>
</p>
<dl class="section return"><dt>Returns</dt><dd><code>VOID</code> <br/>
</dd></dl>
<p><b>Code:</b> </p>
<div class="fragment"><div class="line">ife a, INTERRUPT_MESSAGE_DEBUGBREAK</div>
<div class="line">    jmp interrupt_handler_breakpoint</div>
<div class="line"></div>
<div class="line">ife a, INTERRUPT_MESSAGE_THREADENDCYCLE</div>
<div class="line">    jmp threading_interrupt</div>
<div class="line"></div>
<div class="line">ife a, INTERRUPT_MESSAGE_KERNELERROR</div>
<div class="line">    jmp interrupt_handler_kernelError</div>
<div class="line"></div>
<div class="line">;If <span class="charliteral">&#39;A&#39;</span> does not fall within the mask of device interrupts</div>
<div class="line">ifl a, INTERRUPT_DEVICEMASK</div>
<div class="line">    rfi A   ;End interrupt handler</div>
<div class="line">    </div>
<div class="line">jmp device_interruptHandler</div>
</div><!-- fragment --><hr/>
 <h2><a class="anchor" id="DASMDOC_S57"></a>
interrupt_handler_breakpoint</h2>
<p><a class="el" href="calling_conventions.html#isrcall">isrcall</a> VOID interrupt_handler_breakpoint() <br/>
<br/>
<b>Description:</b><br/>
 The interrupt handler for INTERRUPT_MESSAGE_DEBUGBREAK. Refer to <a class="el" href="interrupt10c.html#softwareInterrupts">Software Interrupts</a> <br/>
</p>
<dl class="section return"><dt>Returns</dt><dd><code>VOID</code> <br/>
</dd></dl>
<p><b>Code:</b> </p>
<div class="fragment"><div class="line">rfi a </div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="md__code.html">Code</a></li>
    <li class="footer">Generated on Sat Apr 13 2013 17:37:42 for DarkCPU by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
