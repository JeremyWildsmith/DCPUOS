<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>DarkCPU: $title</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">DarkCPU
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('device10c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#deviceManager">Device</a><ul><li class="level2"><a href="#deviceManagerDetails">Module Details</a></li>
<li class="level2"><a href="#deviceManagerDevice">Device Manager</a></li>
<li class="level2"><a href="#deviceEntryLayout">Device Manager Entry</a></li>
</ul>
</li>
<li class="level1"><a href="#DASMDOC_S28">Constants</a><ul><li class="level2"><a href="#DASMDOC_S29">DEVICE_DEVICEENTRY_OFFSET_HARDWAREIDLOW</a></li>
<li class="level2"><a href="#DASMDOC_S30">DEVICE_DEVICEENTRY_OFFSET_HARDWAREIDHIGH</a></li>
<li class="level2"><a href="#DASMDOC_S31">DEVICE_DEVICEENTRY_OFFSET_HARDWAREVERSION</a></li>
<li class="level2"><a href="#DASMDOC_S32">DEVICE_DEVICEENTRY_OFFSET_HANDLER</a></li>
<li class="level2"><a href="#DASMDOC_S33">DEVICE_DEVICEENTRY_SIZE</a></li>
<li class="level2"><a href="#DASMDOC_S34">DEVICE_DEVICEENTRY_MAXENTRIES</a></li>
<li class="level2"><a href="#DASMDOC_S35">DEVICE_DEVICEENTRY_MAXENTRYINDEX</a></li>
<li class="level2"><a href="#DASMDOC_S36">DEVICE_DEVICEENTRY_INVALIDENTRY</a></li>
</ul>
</li>
<li class="level1"><a href="#DASMDOC_S37">Data</a><ul><li class="level2"><a href="#DASMDOC_S38">device_deviceEntryTable</a></li>
</ul>
</li>
<li class="level1"><a href="#DASMDOC_S39">Functions</a><ul><li class="level2"><a href="#DASMDOC_S40">device_init</a></li>
<li class="level2"><a href="#DASMDOC_S41">device_getDeviceInterruptMessage</a></li>
<li class="level2"><a href="#DASMDOC_S42">device_findIndexOfDevice</a></li>
<li class="level2"><a href="#DASMDOC_S43">device_allocateDevice</a></li>
<li class="level2"><a href="#DASMDOC_S44">device_freeDevice</a></li>
<li class="level2"><a href="#DASMDOC_S45">device_defaultInterruptHandler</a></li>
<li class="level2"><a href="#DASMDOC_S46">device_interruptHandler</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h2>device10c</h2>
<h1><a class="anchor" id="deviceManager"></a>
Device</h1>
<h2><a class="anchor" id="deviceManagerDetails"></a>
Module Details</h2>
<p>This module contains several routines that allow exclusive access to allocated devices. This module is also responsible for translating hardware interrupts to their appropriate handlers. </p>
<dl class="section author"><dt>Author</dt><dd>Jeremy (0x10cforums.com) </dd></dl>
<dl class="section version"><dt>Version</dt><dd>1.0 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>Dec, 18, 2012</dd></dl>
<h2><a class="anchor" id="deviceManagerDevice"></a>
Device Manager</h2>
<p>The kernel implements a device manager to allow drivers to effectivley communicate with peripheral hardware devices. The device manager contains several routines for allocating and gaining exclusive access to a device. The device manager also enables drivers to register a callback routine that will be invoked once the allocated device attempts to communicate with the driver.</p>
<p>When the kernel device manager module is initialized, it generates list of all peripheral devices attached to the machine. Each entry in this list is stored as a DEVICE_DEVICEENTRY <a class="el" href="device10c.html#deviceEntryLayout">Device Manager Entry</a>. If the handler field is empty, the device is considered to be free, or not allocated.</p>
<p>Once a device has been allocated by the device manager, it will be mapped to an approriate interrupt message code. The allocating driver must configure its device to raise interrupts using that message code so that its registered callback handler will be invoked when the device raises an interrupt. Mapping the device to any other interrupt message code could cause a system error. The message code for an allocated device can be found by invoknig device_getDeviceInterruptMessage</p>
<h2><a class="anchor" id="deviceEntryLayout"></a>
Device Manager Entry</h2>
<h2>Layout of the DeviceEntry structure</h2>
<table class="doxtable">
<tr>
<th>Offset </th><th>Name </th><th>Description</th></tr>
<tr>
<td>DEVICE_DEVICEENTRY_OFFSET_HARDWAREIDLOW </td><td>wHwIdLow </td><td>Low portion of the dword describing the hardware id of the device. </td></tr>
<tr>
<td>DEVICE_DEVICEENTRY_OFFSET_HARDWAREIDHIGH </td><td>wHwIdHigh </td><td>High portion of the dword describing the hardware id of the device. </td></tr>
<tr>
<td>DEVICE_DEVICEENTRY_OFFSET_HARDWAREVERSION </td><td>wVersion </td><td>The version number of the device. </td></tr>
<tr>
<td>DEVICE_DEVICEENTRY_OFFSET_HANDLER </td><td>pHandler </td><td>A pointer to the callback routine which handles interrupts raised by this device, or 0 if the device has not been allocated. </td></tr>
</table>
<h1><a class="anchor" id="DASMDOC_S28"></a>
Constants</h1>
<hr/>
 <h2><a class="anchor" id="DASMDOC_S29"></a>
DEVICE_DEVICEENTRY_OFFSET_HARDWAREIDLOW</h2>
<p><code>WORD</code> DEVICE_DEVICEENTRY_OFFSET_HARDWAREIDLOW <br/>
<br/>
<b>Description:</b><br/>
 Offset to the wHwIdLow member of the DeviceEntry structure. Refer to <a class="el" href="device10c.html#deviceEntryLayout">Device Manager Entry</a> <br/>
<br/>
</p>
<p><b>Code:</b> </p>
<div class="fragment"><div class="line"><span class="preprocessor">#define DEVICE_DEVICEENTRY_OFFSET_HARDWAREIDLOW   0</span></div>
</div><!-- fragment --><hr/>
 <h2><a class="anchor" id="DASMDOC_S30"></a>
DEVICE_DEVICEENTRY_OFFSET_HARDWAREIDHIGH</h2>
<p><code>WORD</code> DEVICE_DEVICEENTRY_OFFSET_HARDWAREIDHIGH <br/>
<br/>
<b>Description:</b><br/>
 Offset to the wHwIdHigh member of the DeviceEntry structure. Refer to <a class="el" href="device10c.html#deviceEntryLayout">Device Manager Entry</a> <br/>
<br/>
</p>
<p><b>Code:</b> </p>
<div class="fragment"><div class="line"><span class="preprocessor">#define DEVICE_DEVICEENTRY_OFFSET_HARDWAREIDHIGH  1</span></div>
</div><!-- fragment --><hr/>
 <h2><a class="anchor" id="DASMDOC_S31"></a>
DEVICE_DEVICEENTRY_OFFSET_HARDWAREVERSION</h2>
<p><code>WORD</code> DEVICE_DEVICEENTRY_OFFSET_HARDWAREVERSION <br/>
<br/>
<b>Description:</b><br/>
 Offset to the wVersion member of the DeviceEntry structure. Refer to <a class="el" href="device10c.html#deviceEntryLayout">Device Manager Entry</a> <br/>
<br/>
</p>
<p><b>Code:</b> </p>
<div class="fragment"><div class="line"><span class="preprocessor">#define DEVICE_DEVICEENTRY_OFFSET_HARDWAREVERSION     2</span></div>
</div><!-- fragment --><hr/>
 <h2><a class="anchor" id="DASMDOC_S32"></a>
DEVICE_DEVICEENTRY_OFFSET_HANDLER</h2>
<p><code>WORD</code> DEVICE_DEVICEENTRY_OFFSET_HANDLER <br/>
<br/>
<b>Description:</b><br/>
 Offset to the pHandler member of the DeviceEntry structure. Refer to <a class="el" href="device10c.html#deviceEntryLayout">Device Manager Entry</a> <br/>
<br/>
</p>
<p><b>Code:</b> </p>
<div class="fragment"><div class="line"><span class="preprocessor">#define DEVICE_DEVICEENTRY_OFFSET_HANDLER             3</span></div>
</div><!-- fragment --><hr/>
 <h2><a class="anchor" id="DASMDOC_S33"></a>
DEVICE_DEVICEENTRY_SIZE</h2>
<p><code>WORD</code> DEVICE_DEVICEENTRY_SIZE <br/>
<br/>
<b>Description:</b><br/>
 Size of DeviceEntry structure in words. Refer to <a class="el" href="device10c.html#deviceEntryLayout">Device Manager Entry</a> <br/>
<br/>
</p>
<p><b>Code:</b> </p>
<div class="fragment"><div class="line"><span class="preprocessor">#define DEVICE_DEVICEENTRY_SIZE                       4</span></div>
</div><!-- fragment --><hr/>
 <h2><a class="anchor" id="DASMDOC_S34"></a>
DEVICE_DEVICEENTRY_MAXENTRIES</h2>
<p><code>WORD</code> DEVICE_DEVICEENTRY_MAXENTRIES <br/>
<br/>
<b>Description:</b><br/>
 Defines the maximum number of support peripheral devices. <br/>
<br/>
</p>
<p><b>Code:</b> </p>
<div class="fragment"><div class="line"><span class="preprocessor">#define DEVICE_DEVICEENTRY_MAXENTRIES             16</span></div>
</div><!-- fragment --><hr/>
 <h2><a class="anchor" id="DASMDOC_S35"></a>
DEVICE_DEVICEENTRY_MAXENTRYINDEX</h2>
<p><code>WORD</code> DEVICE_DEVICEENTRY_MAXENTRYINDEX <br/>
<br/>
<b>Description:</b><br/>
 Defines the maximum possible valid DeviceEntry index into the internal list of DeviceEntry. <br/>
<br/>
</p>
<p><b>Code:</b> </p>
<div class="fragment"><div class="line"><span class="preprocessor">#define DEVICE_DEVICEENTRY_MAXENTRYINDEX          15</span></div>
</div><!-- fragment --><hr/>
 <h2><a class="anchor" id="DASMDOC_S36"></a>
DEVICE_DEVICEENTRY_INVALIDENTRY</h2>
<p><code>WORD</code> DEVICE_DEVICEENTRY_INVALIDENTRY <br/>
<br/>
<b>Description:</b><br/>
 Defines the value given to an invalid DeviceEntry entry. <br/>
<br/>
</p>
<p><b>Code:</b> </p>
<div class="fragment"><div class="line"><span class="preprocessor">#define DEVICE_DEVICEENTRY_INVALIDENTRY               0xFFFF</span></div>
</div><!-- fragment --><h1><a class="anchor" id="DASMDOC_S37"></a>
Data</h1>
<hr/>
 <h2><a class="anchor" id="DASMDOC_S38"></a>
device_deviceEntryTable</h2>
<p><code>WORD</code> device_deviceEntryTable <br/>
<br/>
<b>Description:</b><br/>
 Internal data table where the state of all the attached peripheral devices are stored. <br/>
<br/>
</p>
<p><b>Code:</b> </p>
<div class="fragment"><div class="line">dat 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000</div>
<div class="line">dat 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000</div>
<div class="line">dat 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000</div>
<div class="line">dat 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000</div>
</div><!-- fragment --><h1><a class="anchor" id="DASMDOC_S39"></a>
Functions</h1>
<hr/>
 <h2><a class="anchor" id="DASMDOC_S40"></a>
device_init</h2>
<p><a class="el" href="calling_conventions.html#cdecl">cdecl</a> VOID device_init() <br/>
<br/>
<b>Description:</b><br/>
 This routine is responsible for initilizing the device manager module. It begins by initilizing the internal device entry table and gathering information about all attached peripheral devices. <br/>
</p>
<dl class="section return"><dt>Returns</dt><dd><code>VOID</code> <br/>
</dd></dl>
<p><b>Code:</b> </p>
<div class="fragment"><div class="line">    _push b     ; cdecl calling convention states these must be preserved.</div>
<div class="line">    _push x     ; Preserve x &amp; Y</div>
<div class="line">    _push i</div>
<div class="line">    </div>
<div class="line">    hwn i   ; Store the number of peripheral devices into A</div>
<div class="line"></div>
<div class="line">    ifg i, DEVICE_DEVICEENTRY_MAXENTRIES</div>
<div class="line">        <span class="keyword">set</span> i, DEVICE_DEVICEENTRY_MAXENTRIES</div>
<div class="line">    </div>
<div class="line">    device_init_findLoop:</div>
<div class="line">        sub i, 1                                ; Decrement A by 1</div>
<div class="line">        ife i, 0xFFFF                           ; If A was 0 when we subtracted 1</div>
<div class="line">            jmp device_init_findLoop_end        ; We are done enumerating through all devices, end the loop.</div>
<div class="line"></div>
<div class="line">        hwq i</div>
<div class="line">        </div>
<div class="line">        <span class="keyword">set</span> x, i</div>
<div class="line">        mul x, DEVICE_DEVICEENTRY_SIZE</div>
<div class="line">        add x, device_deviceEntryTable</div>
<div class="line">        </div>
<div class="line">        <span class="keyword">set</span> [x + DEVICE_DEVICEENTRY_OFFSET_HARDWAREIDLOW], a</div>
<div class="line">        <span class="keyword">set</span> [x + DEVICE_DEVICEENTRY_OFFSET_HARDWAREIDHIGH], b</div>
<div class="line">        <span class="keyword">set</span> [x + DEVICE_DEVICEENTRY_OFFSET_HARDWAREVERSION], c</div>
<div class="line">            </div>
<div class="line">        jmp device_init_findLoop</div>
<div class="line">        </div>
<div class="line">device_init_findLoop_end:</div>
<div class="line"></div>
<div class="line">    _pop i          ; Restore registers state</div>
<div class="line">    _pop x</div>
<div class="line">    _pop b</div>
<div class="line">    ret</div>
</div><!-- fragment --><hr/>
 <h2><a class="anchor" id="DASMDOC_S41"></a>
device_getDeviceInterruptMessage</h2>
<p><a class="el" href="calling_conventions.html#cdecl">cdecl</a> WORD device_getDeviceInterruptMessage(<code>WORD</code> wDeviceIndex) <br/>
<br/>
<b>Description:</b><br/>
 Used to acquire the appropriate interrupt message corresponding to a given device index. <br/>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">wDeviceIndex</td><td><code>WORD</code> Index of the device to acquire the corresponding interrupt message code for. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>WORD</code> The interrupt message code which corresponds to the provided device index <br/>
</dd></dl>
<p><b>Code:</b> </p>
<div class="fragment"><div class="line">_sfBegin(0)</div>
<div class="line">_sfArg(a, 0)</div>
<div class="line"></div>
<div class="line">bor a, INTERRUPT_DEVICEMASK</div>
<div class="line"></div>
<div class="line">_sfEnd()</div>
<div class="line">ret </div>
</div><!-- fragment --><hr/>
 <h2><a class="anchor" id="DASMDOC_S42"></a>
device_findIndexOfDevice</h2>
<p><a class="el" href="calling_conventions.html#cdecl">cdecl</a> WORD device_findIndexOfDevice(<code>WORD</code> wDeviceIdLow, <code>WORD</code> wDeviceIdHigh, <code>WORD</code> wStartIndex) <br/>
<br/>
<b>Description:</b><br/>
 Used to acquire the appropriate device index corresponding to the given device id <br/>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">wDeviceIdLow</td><td><code>WORD</code> Lower word of the id corresponding to the device that is to be found. </td></tr>
    <tr><td class="paramname">wDeviceIdHigh</td><td><code>WORD</code> Higher word of the id corresponding to the device that is to be found. </td></tr>
    <tr><td class="paramname">wStartIndex</td><td><code>WORD</code> The index from which to begin the search </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>WORD</code> Returns DEVICE_DEVICEENTRY_INVALIDENTRY if no device found, otherwise returns the index of the device. <br/>
</dd></dl>
<p><b>Code:</b> </p>
<div class="fragment"><div class="line">    _sfBegin(0)</div>
<div class="line">    _sfArg(a, 2)</div>
<div class="line"></div>
<div class="line">    device_findIndexOfDevice_findDeviceLoop:</div>
<div class="line">        ife a, DEVICE_DEVICEENTRY_MAXENTRIES</div>
<div class="line">            jmp device_findIndexOfDevice_deviceNotFound</div>
<div class="line">        </div>
<div class="line">        set c, a</div>
<div class="line">        mul c, DEVICE_DEVICEENTRY_SIZE</div>
<div class="line">        add c, device_deviceEntryTable</div>
<div class="line">        </div>
<div class="line">        ife [c + DEVICE_DEVICEENTRY_OFFSET_HARDWAREIDLOW], 0</div>
<div class="line">            jmp device_findIndexOfDevice_deviceNotFound</div>
<div class="line">        </div>
<div class="line">        _sfArgIfNotEquals(0, [c + DEVICE_DEVICEENTRY_OFFSET_HARDWAREIDLOW])</div>
<div class="line">            jmp device_findIndexOfDevice_findDeviceLoop_nextDevice</div>
<div class="line">        </div>
<div class="line">        _sfArgIfNotEquals(1, [C + DEVICE_DEVICEENTRY_OFFSET_HARDWAREIDHIGH])</div>
<div class="line">            jmp device_findIndexOfDevice_findDeviceLoop_nextDevice</div>
<div class="line"></div>
<div class="line">        jmp device_findIndexOfDevice_end</div>
<div class="line">        </div>
<div class="line">        device_findIndexOfDevice_findDeviceLoop_nextDevice:</div>
<div class="line">            add a, 1</div>
<div class="line">            jmp device_findIndexOfDevice_findDeviceLoop</div>
<div class="line">            </div>
<div class="line">device_findIndexOfDevice_end:</div>
<div class="line">    _sfEnd()</div>
<div class="line">    ret</div>
<div class="line">        </div>
<div class="line">device_findIndexOfDevice_deviceNotFound:</div>
<div class="line">    set a, DEVICE_DEVICEENTRY_INVALIDENTRY</div>
<div class="line">    jmp device_findIndexOfDevice_end </div>
</div><!-- fragment --><hr/>
 <h2><a class="anchor" id="DASMDOC_S43"></a>
device_allocateDevice</h2>
<p><a class="el" href="calling_conventions.html#cdecl">cdecl</a> WORD device_allocateDevice(<code>WORD</code> wDeviceIdLow, <code>WORD</code> wDeviceIdHigh, <code>WORD</code> pInterruptHandler) <br/>
<br/>
<b>Description:</b><br/>
 Used to allocate and gain exclusive access to a device. <br/>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">wDeviceIdLow</td><td><code>WORD</code> Lower word of the id corresponding to the device that is to be found. </td></tr>
    <tr><td class="paramname">wDeviceIdHigh</td><td><code>WORD</code> Higher word of the id corresponding to the device that is to be found. </td></tr>
    <tr><td class="paramname">pInterruptHandler</td><td><code>WORD</code> Callback routine invoked via naked-isr calling convention whenever this allocate device raises an interrupt. If this entry is 0, an internal handler which performs no function is used instead. Note though that even if this parameter is zero, you must still configure the device using the proper interrupt message code. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>WORD</code> Returns DEVICE_DEVICEENTRY_INVALIDENTRY if no device found, otherwise returns the index of the device. <br/>
</dd></dl>
<p><b>Code:</b> </p>
<div class="fragment"><div class="line">_sfBegin(0)</div>
<div class="line">_push 0</div>
<div class="line">_sfArg(push, 1)     ;Setup stack for calling findIndex</div>
<div class="line">_sfArg(push, 0)</div>
<div class="line"></div>
<div class="line">device_allocateDevice_findDeviceLoop:</div>
<div class="line">    ife [sp+2], DEVICE_DEVICEENTRY_MAXENTRIES       ;If current index exceed max entries</div>
<div class="line">        jmp device_allocateDevice_deviceNotFound    ;We searched all the devices and were unable to locate that device. Return error.</div>
<div class="line">    </div>
<div class="line">    call device_findIndexOfDevice</div>
<div class="line"></div>
<div class="line">    ife a, DEVICE_DEVICEENTRY_INVALIDENTRY</div>
<div class="line">        jmp device_allocateDevice_deviceNotFound</div>
<div class="line">    </div>
<div class="line">    mul a, DEVICE_DEVICEENTRY_SIZE</div>
<div class="line">    add a, device_deviceEntryTable</div>
<div class="line">    </div>
<div class="line">    ife [a + DEVICE_DEVICEENTRY_OFFSET_HANDLER], 0</div>
<div class="line">        jmp device_allocateDevice_deviceFound</div>
<div class="line">    </div>
<div class="line">    add [sp+2], 1</div>
<div class="line">    jmp device_allocateDevice_findDeviceLoop</div>
<div class="line">    </div>
<div class="line">device_allocateDevice_deviceFound:</div>
<div class="line">    </div>
<div class="line">    _push A</div>
<div class="line">    call threading_lock</div>
<div class="line">    </div>
<div class="line">    set a, [sp]</div>
<div class="line">    </div>
<div class="line">    _sfArg(c, 2)</div>
<div class="line">    </div>
<div class="line">    ife c, 0</div>
<div class="line">        set c, device_defaultInterruptHandler</div>
<div class="line">        </div>
<div class="line">    set [a + DEVICE_DEVICEENTRY_OFFSET_HANDLER], c</div>
<div class="line">    </div>
<div class="line">    call threading_free</div>
<div class="line">    </div>
<div class="line">    _pop a</div>
<div class="line">    sub a, device_deviceEntryTable</div>
<div class="line">    div a, DEVICE_DEVICEENTRY_SIZE</div>
<div class="line">    </div>
<div class="line">    add sp, 3</div>
<div class="line">    _sfEnd()</div>
<div class="line">    ret</div>
<div class="line">    </div>
<div class="line">device_allocateDevice_deviceNotFound:</div>
<div class="line">    set a, DEVICE_DEVICEENTRY_INVALIDENTRY</div>
<div class="line">    add sp, 3</div>
<div class="line">    _sfEnd()</div>
<div class="line">    ret </div>
</div><!-- fragment --><hr/>
 <h2><a class="anchor" id="DASMDOC_S44"></a>
device_freeDevice</h2>
<p><a class="el" href="calling_conventions.html#cdecl">cdecl</a> WORD device_freeDevice(<code>WORD</code> wDeviceIndex) <br/>
<br/>
<b>Description:</b><br/>
 Used to to free a previously allocated allocate. <br/>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">wDeviceIndex</td><td><code>WORD</code> The index of the device to be freed </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>WORD</code> Returns a 0 if the operation failed due to the given index being out of range, and anything else if it was a success. <br/>
</dd></dl>
<p><b>Code:</b> </p>
<div class="fragment"><div class="line">    _sfBegin(0)</div>
<div class="line">    </div>
<div class="line">    _sfArgIfEquals(0, DEVICE_DEVICEENTRY_MAXENTRYINDEX)</div>
<div class="line">        jmp device_freeDevice_outOfRange</div>
<div class="line">    </div>
<div class="line">    _sfArg(c, 0)</div>
<div class="line">    mul c, DEVICE_DEVICEENTRY_SIZE</div>
<div class="line">    add c, device_deviceEntryTable</div>
<div class="line">    </div>
<div class="line">    _push c</div>
<div class="line">    call threading_lock</div>
<div class="line">    </div>
<div class="line">    _pop c</div>
<div class="line">    set [c + DEVICE_DEVICEENTRY_OFFSET_HANDLER], 0</div>
<div class="line">    </div>
<div class="line">    call threading_free</div>
<div class="line"></div>
<div class="line">    set a, 1</div>
<div class="line">    _sfEnd()</div>
<div class="line">    ret</div>
<div class="line">    </div>
<div class="line">device_freeDevice_outOfRange:</div>
<div class="line">    set A, 0</div>
<div class="line">    _sfEnd()</div>
<div class="line">    ret</div>
</div><!-- fragment --><hr/>
 <h2><a class="anchor" id="DASMDOC_S45"></a>
device_defaultInterruptHandler</h2>
<p><a class="el" href="calling_conventions.html#isrcall">isrcall</a> VOID device_defaultInterruptHandler() <br/>
<br/>
<b>Description:</b><br/>
 Interrupt handler assigned to devices which have been allocated but have not been provided a callback routine. This callback routine fills there place and performs no function. <br/>
</p>
<dl class="section return"><dt>Returns</dt><dd><code>VOID</code> <br/>
</dd></dl>
<p><b>Code:</b> </p>
<div class="fragment"><div class="line">rfi a </div>
</div><!-- fragment --><hr/>
 <h2><a class="anchor" id="DASMDOC_S46"></a>
device_interruptHandler</h2>
<p><a class="el" href="calling_conventions.html#isrcall">isrcall</a> VOID device_interruptHandler() <br/>
<br/>
<b>Description:</b><br/>
 The device manager's interrupt handler. This handler is invoked whenever a configured device has raised an interrupt and is responsible for forwarding these interrupts to their appropriate registered handlers. <br/>
</p>
<dl class="section return"><dt>Returns</dt><dd><code>VOID</code> <br/>
</dd></dl>
<p><b>Code:</b> </p>
<div class="fragment"><div class="line">and a, 0x00FF</div>
<div class="line"></div>
<div class="line">ifg a, DEVICE_DEVICEENTRY_MAXENTRYINDEX</div>
<div class="line">    <span class="keywordtype">int</span> INTERRUPT_MESSAGE_KERNELERROR</div>
<div class="line"></div>
<div class="line">mul a, DEVICE_DEVICEENTRY_SIZE</div>
<div class="line">add A, device_deviceEntryTable</div>
<div class="line"><span class="keyword">set</span> a, [A + DEVICE_DEVICEENTRY_OFFSET_HANDLER]</div>
<div class="line"></div>
<div class="line">jmp a</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="md__code.html">Code</a></li>
    <li class="footer">Generated on Sat Apr 13 2013 17:37:42 for DarkCPU by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
