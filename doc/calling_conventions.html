<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>DarkCPU: Calling Conventions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">DarkCPU
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('calling_conventions.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Calling Conventions </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#s_isrcall">ISRCall</a></li>
<li class="level1"><a href="#_cdecl">cdecl</a></li>
<li class="level1"><a href="#_nakedcall">NakedCall</a></li>
<li class="level1"><a href="#_asyncCall">Asynchronous Invoke</a></li>
</ul>
</div>
<div class="textblock"><p>This page contains detail regarding the calling-conventions used throughout the kernel. These are essentially a list of rules which must be followed when invoking functions which use a specified calling convention.</p>
<hr/>
 <h1><a class="anchor" id="s_isrcall"></a>
ISRCall</h1>
<p><a class="anchor" id="isrcall"></a>The naked ISR calling convention is used frequently by interrupt handlers or interrupt service routines (ISRs) on the DCPU. When the DCPU invokes an ISR, it uses this calling convention. This convention leaves no room for return data, and only one WORD as an argument. The convention states the following:</p>
<ul>
<li>The caller will place the return address on the stack followed the contents of the 'A' register (to preserve the register's state) That is to say, the return address is pushed to the stack, then the state of the 'A' register.</li>
<li>The 'A' register is then set to equal the argument to invoke the callee with.</li>
<li>The caller then jumps to the callee</li>
<li>The callee must not corrupt any registers other than the 'A' register (which it will restore before it returns, see below)</li>
<li>When the callee has finished executing, it must pop the previously preserved 'A' register off of the stack and store the results inside of the A register.</li>
<li>The callee then pops the return address off of the stack and jumps to the return address.</li>
</ul>
<p>The callee can also return to the caller by using the rfi instruction (return from interrupt)</p>
<hr/>
 <h1><a class="anchor" id="_cdecl"></a>
cdecl</h1>
<p><a class="anchor" id="cdecl"></a>The cdecl calling convention is used for most of the routines inside of the kernel image. The cdecl calling convention used inside of the kernel image is a slight modification of the cdecl calling convention. It is as follows:</p>
<ul>
<li>The caller pushes the arguments on the stack to the callee in reverse order</li>
<li>The caller invokes the calle with a jsr instruction (a call)</li>
<li>The callee is permitted to destroy only the A, Y, EX and the C registers while performing its function.</li>
<li>The callee returns to the caller by poping the return address off of the stack. The result of the function can be returned via the 'A' register</li>
<li>The caller is responsible for cleaning up the arguments pushed on the stack.</li>
</ul>
<p>The cdecl is the most frequently used calling convention in the DarkCPU kernel.</p>
<hr/>
 <h1><a class="anchor" id="_nakedcall"></a>
NakedCall</h1>
<p><a class="anchor" id="nakedcall"></a>A naked function does not define a standard calling convention, and the details regarding its calling convention should either be detailed in the documentation for the function or not defined at all. If they are not defined, the procedure is not meant to be explicitly called.</p>
<hr/>
 <h1><a class="anchor" id="_asyncCall"></a>
Asynchronous Invoke</h1>
<p><a class="anchor" id="asynccall"></a>The Asynchronous Invoke calling convention is used when applications or modules are invoking a routine without passing control of their thread over to the callee. An executable image's entrypoint or a thread's entrypoint use the Asynchronous Invoke calling convention. The calling convention for a Asynchronous Invoke call is the following:</p>
<ul>
<li>The caller places the argument it wishes to pass to the callee in the 'A' register of the thread that will be used to invoke the callee</li>
<li>The caller invokes a thread or another form parallel execution on the callee</li>
<li>Both threads continue to execute. The callee does not return to the caller in any form.</li>
<li>The caller is expected to setup the callee such that when it returns, its thread of execution is disposed properly. </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="md__conventions.html">Conventions</a></li>
    <li class="footer">Generated on Sat Apr 13 2013 17:37:42 for DarkCPU by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
