<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>DarkCPU: $title</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">DarkCPU
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('mutex10c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#mutex">MutexManager</a><ul><li class="level2"><a href="#MUTEXDetails">Module Details</a></li>
<li class="level2"><a href="#MutexManager">Mutexes</a></li>
</ul>
</li>
<li class="level1"><a href="#DASMDOC_S79">Constants</a><ul><li class="level2"><a href="#DASMDOC_S80">MUTEX_INVALIDMUTEX</a></li>
<li class="level2"><a href="#DASMDOC_S81">MUTEX_TABLE_ENTRIES</a></li>
</ul>
</li>
<li class="level1"><a href="#DASMDOC_S82">Data</a><ul><li class="level2"><a href="#DASMDOC_S83">mutex_mutexAllocationTable</a></li>
<li class="level2"><a href="#DASMDOC_S84">mutex_mutexStateTable</a></li>
</ul>
</li>
<li class="level1"><a href="#DASMDOC_S85">Functions</a><ul><li class="level2"><a href="#DASMDOC_S86">mutex_create</a></li>
<li class="level2"><a href="#DASMDOC_S87">mutex_destroy</a></li>
<li class="level2"><a href="#DASMDOC_S88">mutex_lock</a></li>
<li class="level2"><a href="#DASMDOC_S89">mutex_wait</a></li>
<li class="level2"><a href="#DASMDOC_S90">mutex_release</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>Handles allocation, locking, releasing and freeing of system synchronization mutex objects.</p>
<h2>mutex10c</h2>
<h1><a class="anchor" id="mutex"></a>
MutexManager</h1>
<h2><a class="anchor" id="MUTEXDetails"></a>
Module Details</h2>
<p>This module contains several routines for mutating mutex synchronization objects. </p>
<dl class="section author"><dt>Author</dt><dd>Jeremy (0x10cforums.com) </dd></dl>
<dl class="section version"><dt>Version</dt><dd>1.0 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>Dec, 18, 2012</dd></dl>
<h2><a class="anchor" id="MutexManager"></a>
Mutexes</h2>
<p>When multiple threads are running along-side one another, it is important to assure that these threads do not access the same resource at the same point in time. As doing so may result in either thread mutating a corrupted resource. To avoid the conflict of multiple threads accessing a single resource at a time, mutex synchronization objects are used. A mutex synchronization object has either one of two states. It is either locked, or unlocked.</p>
<p>A mutex can be requested to be locked via one of the locking routines. A mutex can only be locked if it is in its unlocked state. If a thread attempts to lock a mutex which is already locked, the thread will idle until the mutex is released by whichever thread was responsible for locking it. Once the mutex is released, the idling thread will be able to lock the mutex and resume on executing.</p>
<p>Mutexes are very useful for ensuring that a given thread has exclusive access to a resource, however, be very careful when using mutexes as they may cause bugs in your program that are very difficult to locate and reproduce.</p>
<dl class="section note"><dt>Note</dt><dd>In Dark CPU, when a thread 'idles' it actually just passes control over to the next thread in the queue to avoid wasting CPU time.</dd></dl>
<h1><a class="anchor" id="DASMDOC_S79"></a>
Constants</h1>
<hr/>
 <h2><a class="anchor" id="DASMDOC_S80"></a>
MUTEX_INVALIDMUTEX</h2>
<p><code>WORD</code> MUTEX_INVALIDMUTEX <br/>
<br/>
<b>Description:</b><br/>
 Defines the value given to an invalid mutex. <br/>
<br/>
</p>
<p><b>Code:</b> </p>
<div class="fragment"><div class="line"><span class="preprocessor">#define MUTEX_INVALIDMUTEX        0xFFFF</span></div>
</div><!-- fragment --><hr/>
 <h2><a class="anchor" id="DASMDOC_S81"></a>
MUTEX_TABLE_ENTRIES</h2>
<p><code>WORD</code> MUTEX_TABLE_ENTRIES <br/>
<br/>
<b>Description:</b><br/>
 Defines number of entries in the mutex allocation and mutex state tables <br/>
<br/>
</p>
<p><b>Code:</b> </p>
<div class="fragment"><div class="line"><span class="preprocessor">#define MUTEX_TABLE_ENTRIES   96</span></div>
</div><!-- fragment --><h1><a class="anchor" id="DASMDOC_S82"></a>
Data</h1>
<hr/>
 <h2><a class="anchor" id="DASMDOC_S83"></a>
mutex_mutexAllocationTable</h2>
<p><code>WORD</code> mutex_mutexAllocationTable <br/>
<br/>
<b>Description:</b><br/>
 A bitmap that stores which mutexes are allocate and which mutexes are free. Each entry in this bitmap coin-sides with an ehtry in the mutex state table. <br/>
<br/>
</p>
<p><b>Code:</b> </p>
<div class="fragment"><div class="line">DAT 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000</div>
</div><!-- fragment --><hr/>
 <h2><a class="anchor" id="DASMDOC_S84"></a>
mutex_mutexStateTable</h2>
<p><code>WORD</code> mutex_mutexStateTable <br/>
<br/>
<b>Description:</b><br/>
 A bitmap that stores the state of allocated mutexes. Whether or no the mutex is locked or free. <br/>
<br/>
</p>
<p><b>Code:</b> </p>
<div class="fragment"><div class="line">DAT 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000</div>
</div><!-- fragment --><h1><a class="anchor" id="DASMDOC_S85"></a>
Functions</h1>
<hr/>
 <h2><a class="anchor" id="DASMDOC_S86"></a>
mutex_create</h2>
<p><a class="el" href="calling_conventions.html#cdecl">cdecl</a> MUTEX mutex_create() <br/>
<br/>
<b>Description:</b><br/>
 Creates a mutex object. Mutex objects, when created, are in an unlocked state. <br/>
</p>
<dl class="section return"><dt>Returns</dt><dd><code>MUTEX</code> The mutex object index allocated for this mutex. <br/>
</dd></dl>
<p><b>Code:</b> </p>
<div class="fragment"><div class="line">    _push mutex_mutexAllocationTable</div>
<div class="line">    _push 0</div>
<div class="line"></div>
<div class="line">    mutex_create_findMutexLoop:</div>
<div class="line">        ife [sp], MUTEX_TABLE_ENTRIES</div>
<div class="line">            jmp mutex_create_notFound</div>
<div class="line">        </div>
<div class="line">        call bitmap_get</div>
<div class="line">        </div>
<div class="line">        ife a, 0</div>
<div class="line">            jmp mutex_create_found</div>
<div class="line">        </div>
<div class="line">        add [sp], 1</div>
<div class="line">        </div>
<div class="line">        jmp mutex_create_findMutexLoop</div>
<div class="line"></div>
<div class="line">mutex_create_found:</div>
<div class="line">    call bitmap_set</div>
<div class="line">    <span class="keyword">set</span> a, [sp]</div>
<div class="line">    add sp, 2</div>
<div class="line">    ret</div>
<div class="line">    </div>
<div class="line">mutex_create_notFound:</div>
<div class="line">    <span class="keyword">set</span> a, MUTEX_INVALIDMUTEX</div>
<div class="line">    add sp, 2</div>
<div class="line">    ret </div>
</div><!-- fragment --><hr/>
 <h2><a class="anchor" id="DASMDOC_S87"></a>
mutex_destroy</h2>
<p><a class="el" href="calling_conventions.html#cdecl">cdecl</a> VOID mutex_destroy(<code>WORD</code> wIndex) <br/>
<br/>
<b>Description:</b><br/>
 Ddeallocates a mutex object of a given index. <br/>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">wIndex</td><td><code>WORD</code> Index of the mutex object to be destroyed </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>VOID</code> <br/>
</dd></dl>
<p><b>Code:</b> </p>
<div class="fragment"><div class="line">_push mutex_mutexAllocationTable</div>
<div class="line">_push [SP+1]</div>
<div class="line">call bitmap_clear</div>
<div class="line">add sp, 2</div>
<div class="line">ret </div>
</div><!-- fragment --><hr/>
 <h2><a class="anchor" id="DASMDOC_S88"></a>
mutex_lock</h2>
<p><a class="el" href="calling_conventions.html#cdecl">cdecl</a> VOID mutex_lock(<code>WORD</code> wIndex) <br/>
<br/>
<b>Description:</b><br/>
 Attempts to lock a mutex object of a given index. This routine will block execution until a lock is achieved via this thread on the mutex. <br/>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">wIndex</td><td><code>WORD</code> Index of the mutex object to be locked </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>VOID</code> <br/>
</dd></dl>
<p><b>Code:</b> </p>
<div class="fragment"><div class="line">    _sfBegin(0)</div>
<div class="line">    _push mutex_mutexStateTable</div>
<div class="line">    _sfArg(push, 0)</div>
<div class="line">    </div>
<div class="line">mutex_lock_attemptLock:</div>
<div class="line">    call threading_lock</div>
<div class="line">    call bitmap_get</div>
<div class="line">    </div>
<div class="line">    ifn a, 0</div>
<div class="line">        jmp mutex_lock_failedLock</div>
<div class="line">    </div>
<div class="line">    call bitmap_set</div>
<div class="line">    </div>
<div class="line">    call threading_free</div>
<div class="line">    </div>
<div class="line">    add sp, 2</div>
<div class="line">    _sfEnd()</div>
<div class="line">    ret</div>
<div class="line">    </div>
<div class="line">mutex_lock_failedLock:</div>
<div class="line">    _threading_endCycle()</div>
<div class="line">    jmp mutex_lock_attemptLock</div>
</div><!-- fragment --><hr/>
 <h2><a class="anchor" id="DASMDOC_S89"></a>
mutex_wait</h2>
<p><a class="el" href="calling_conventions.html#cdecl">cdecl</a> VOID mutex_wait(<code>WORD</code> wIndex) <br/>
<br/>
<b>Description:</b><br/>
 Waits for a mutex object of a given index to be placed in an unlocked state. This routine will block execution until the mutex is placed into an unlocked state. <br/>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">wIndex</td><td><code>WORD</code> Index of the mutex object to be waited upon </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>VOID</code> <br/>
</dd></dl>
<p><b>Code:</b> </p>
<div class="fragment"><div class="line">    _sfBegin(0)</div>
<div class="line">    _push mutex_mutexStateTable</div>
<div class="line">    _sfArg(push, 0)</div>
<div class="line">    </div>
<div class="line">mutex_waitForMutex_getState:</div>
<div class="line">    call threading_lock</div>
<div class="line">    call bitmap_get</div>
<div class="line">    </div>
<div class="line">    ifn a, 0</div>
<div class="line">        jmp mutex_waitForMutex_stateLock</div>
<div class="line">    </div>
<div class="line">    call threading_free</div>
<div class="line">    add sp, 2</div>
<div class="line">    _sfEnd()</div>
<div class="line">    ret</div>
<div class="line">    </div>
<div class="line">mutex_waitForMutex_stateLock:</div>
<div class="line">    _threading_endCycle()</div>
<div class="line">    jmp mutex_waitForMutex_getState </div>
</div><!-- fragment --><hr/>
 <h2><a class="anchor" id="DASMDOC_S90"></a>
mutex_release</h2>
<p><a class="el" href="calling_conventions.html#cdecl">cdecl</a> VOID mutex_release(<code>WORD</code> wIndex) <br/>
<br/>
<b>Description:</b><br/>
 Places a mutex object of a given index into an unlocked state. <br/>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">wIndex</td><td><code>WORD</code> Index of the mutex object to be released </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>VOID</code> <br/>
</dd></dl>
<p><b>Code:</b> </p>
<div class="fragment"><div class="line">_sfBegin(0)</div>
<div class="line">_push mutex_mutexStateTable</div>
<div class="line">_sfArg(push, 0)</div>
<div class="line"></div>
<div class="line">call threading_lock</div>
<div class="line">call bitmap_clear</div>
<div class="line">call threading_free</div>
<div class="line"></div>
<div class="line">add sp, 2</div>
<div class="line">_sfEnd()</div>
<div class="line">ret</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="md__code.html">Code</a></li>
    <li class="footer">Generated on Sat Apr 13 2013 17:37:42 for DarkCPU by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
